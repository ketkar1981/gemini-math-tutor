<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Gemini Math Tutor</title>
    <style>
      body { font-family: system-ui, Arial, sans-serif; max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
      textarea { width: 100%; height: 140px; font-size: 1rem; }
      button { padding: .5rem 1rem; font-size: 1rem; }
      pre { background:#fafafa; padding:1rem; border:1px solid #eee; white-space:pre-wrap }
      .row { display:flex; gap:1rem; align-items:center }
    </style>
  </head>
  <body>
    <h1>Gemini Math Tutor (Frontend)</h1>

    <p>Enter a question for the math tutor and click <strong>Ask</strong>. This UI proxies requests to the backend server at <code>/api/generate</code>.</p>

    <label for="question"><strong>Question</strong></label>
    <textarea id="question" placeholder="E.g. Solve 2x+3=11. Show steps."></textarea>

    <div class="row" style="margin:8px 0">
      <label style="display:flex;align-items:center;"><input id="temperature" type="number" step="0.1" min="0" max="1" value="0.2" style="width:80px;margin-right:8px">Temperature</label>
      <label style="display:flex;align-items:center;"><input id="tokens" type="number" step="1" min="16" value="512" style="width:100px;margin-right:8px">Max tokens</label>
      <button id="ask">Ask</button>
      <span id="status" style="margin-left:1rem;color:#666"></span>
    </div>

    <h3>Answer</h3>
    <pre id="answer">No answer yet.</pre>

    <script>
      const askBtn = document.getElementById('ask');
      const qEl = document.getElementById('question');
      const ansEl = document.getElementById('answer');
      const statusEl = document.getElementById('status');

      async function ask() {
        const question = qEl.value.trim();
        if (!question) return alert('Please enter a question');
        const temperature = parseFloat(document.getElementById('temperature').value) || 0.2;
        const max_output_tokens = parseInt(document.getElementById('tokens').value, 10) || 512;

        statusEl.textContent = 'sending...';
        ansEl.textContent = '';

        try {
          const resp = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question, temperature, max_output_tokens })
          });

          if (!resp.ok) {
            const text = await resp.text();
            throw new Error(`${resp.status}: ${text}`);
          }

          const data = await resp.json();
          // The backend returns { answer: ..., model: ... }
          ansEl.textContent = data.answer || JSON.stringify(data, null, 2);
          statusEl.textContent = `model: ${data.model || 'unknown'}`;
        } catch (err) {
          console.error(err);
          ansEl.textContent = 'Error: ' + (err.message || String(err));
          statusEl.textContent = 'error';
        }
      }

      askBtn.addEventListener('click', ask);

      // Enter to submit when focused in textarea + Ctrl/Cmd+Enter
      qEl.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') ask();
      });
    </script>
  </body>
</html>
